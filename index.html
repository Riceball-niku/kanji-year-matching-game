<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kanji Year Quiz</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .karuta-card {
      font-family: 'Noto Serif JP', serif;
      cursor: pointer;
      transition: all 0.1s ease-in-out;
    }
    .karuta-card:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    .correct { background-color: #10B981 !important; }
    .incorrect { background-color: #F87171 !important; }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center p-4">

  <header class="text-center mb-6">
    <h1 class="text-4xl font-bold text-red-600 mb-2">Kanji Year Quiz</h1>
    <p class="text-gray-300">Select the correct Kanji for the number of years</p>
  </header>

  <!-- Main Menu -->
  <div id="main-menu" class="flex flex-col items-center gap-4">
    <button id="enableAudioBtn" class="px-4 py-2 bg-yellow-500 rounded hover:bg-yellow-600">Enable Audio üîä</button>
    <button id="beginnerBtn" class="px-4 py-2 bg-red-600 rounded hover:bg-red-700">Beginner (20‚Äì100)</button>
    <button id="advancedBtn" class="px-4 py-2 bg-blue-600 rounded hover:bg-blue-700">Advanced (101‚Äì2000)</button>
  </div>

  <!-- Game Container -->
  <div id="game-container" class="hidden flex flex-col items-center">
    <div class="mb-4 text-xl">
      Score: <span id="score">0</span> / 15
    </div>

    <div id="question-container" class="mb-6 text-center">
      <p class="text-gray-300 mb-2">Find the Kanji for:</p>
      <div id="target-number" class="text-6xl font-bold text-yellow-400 mb-4">---</div>
      <div id="choices" class="grid grid-cols-2 gap-4 max-w-md mx-auto"></div>
    </div>

    <div id="feedback" class="text-xl mb-4 h-8 text-center"></div>

    <div class="flex gap-4">
      <button id="restartBtn" class="px-4 py-2 bg-green-600 rounded hover:bg-green-700 hidden">Restart</button>
      <button id="backBtn" class="px-4 py-2 bg-gray-600 rounded hover:bg-gray-500 hidden">Back to Main Menu</button>
    </div>
  </div>

  <script>
    // --- Game State ---
    let level = null;
    let score = 0;
    let questionIndex = 0;
    const totalQuestions = 15;
    let currentNumber = 0;
    let audioEnabled = false;

    // --- Event Listeners ---
    const enableAudioBtn = document.getElementById('enableAudioBtn');
    enableAudioBtn.onclick = () => {
      audioEnabled = true;
      enableAudioBtn.textContent = "Audio Enabled ‚úÖ";
      enableAudioBtn.disabled = true;
    };

    document.getElementById('beginnerBtn').onclick = () => startGame('beginner');
    document.getElementById('advancedBtn').onclick = () => startGame('advanced');
    document.getElementById('restartBtn').onclick = () => startGame(level);
    document.getElementById('backBtn').onclick = () => {
      document.getElementById('game-container').classList.add('hidden');
      document.getElementById('main-menu').classList.remove('hidden');
      resetMenu();
    };

    function resetMenu(){
      document.getElementById('score').textContent = 0;
      document.getElementById('feedback').textContent = '';
      document.getElementById('target-number').textContent = '---';
      document.getElementById('choices').innerHTML = '';
      document.getElementById('restartBtn').classList.add('hidden');
      document.getElementById('backBtn').classList.add('hidden');
    }

    // --- Kanji Conversion ---
    const digits = ["", "‰∏Ä","‰∫å","‰∏â","Âõõ","‰∫î","ÂÖ≠","‰∏É","ÂÖ´","‰πù"];
    function numberToKanji(num) {
      if(num <= 0) return "„Ç®„É©„Éº";
      let result = "";
      const thou = Math.floor(num/1000);
      const hund = Math.floor((num%1000)/100);
      const tens = Math.floor((num%100)/10);
      const unit = num%10;
      if(thou>0) result += thou===1?"ÂçÉ":digits[thou]+"ÂçÉ";
      if(hund>0) result += hund===1?"Áôæ":digits[hund]+"Áôæ";
      if(tens>0) result += tens===1?"ÂçÅ":digits[tens]+"ÂçÅ";
      if(unit>0) result += digits[unit];
      return result;
    }

    // --- Game Functions ---
    function startGame(selectedLevel){
      level = selectedLevel;
      score = 0;
      questionIndex = 0;
      document.getElementById('score').textContent = score;
      document.getElementById('main-menu').classList.add('hidden');
      document.getElementById('game-container').classList.remove('hidden');
      document.getElementById('restartBtn').classList.add('hidden');
      document.getElementById('backBtn').classList.add('hidden');
      nextQuestion();
    }

    function nextQuestion(){
      if(questionIndex >= totalQuestions){
        endGame();
        return;
      }
      const range = level==='beginner'? [20,100] : [101,2000];
      currentNumber = Math.floor(Math.random()*(range[1]-range[0]+1)) + range[0];
      document.getElementById('target-number').textContent = currentNumber;
      generateChoices();
      if(audioEnabled) speakNumber(currentNumber);
      questionIndex++;
    }

    function generateChoices(){
      const correctKanji = numberToKanji(currentNumber);
      const choices = new Set([correctKanji]);
      const range = level==='beginner'? [20,100] : [101,2000];
      while(choices.size<4){
        const num = Math.floor(Math.random()*(range[1]-range[0]+1)) + range[0];
        choices.add(numberToKanji(num));
      }
      const shuffled = Array.from(choices).sort(()=>Math.random()-0.5);
      const container = document.getElementById('choices');
      container.innerHTML = "";
      shuffled.forEach(k=>{
        const card = document.createElement('div');
        card.textContent = k;
        card.className = "karuta-card bg-gray-700 p-4 rounded text-2xl font-bold hover:bg-gray-600";
        card.onclick = ()=>checkAnswer(card, k===correctKanji);
        container.appendChild(card);
      });
    }

    function checkAnswer(card, correct){
      if(correct){
        card.classList.add('correct');
        score++;
        document.getElementById('score').textContent = score;
        document.getElementById('feedback').textContent = "‚úÖ Correct!";
        setTimeout(()=>{ 
          card.classList.remove('correct'); 
          document.getElementById('feedback').textContent=''; 
          nextQuestion(); 
        },700);
      } else{
        card.classList.add('incorrect');
        document.getElementById('feedback').textContent = "‚ùå Incorrect. Game Over!";
        setTimeout(endGame,1000);
      }
    }

    function endGame(){
      document.getElementById('feedback').textContent = `üéâ Finished! Score: ${score} / ${totalQuestions}`;
      document.getElementById('restartBtn').classList.remove('hidden');
      document.getElementById('backBtn').classList.remove('hidden');
    }

    // --- SpeechSynthesis ---
    function speakNumber(num){
      if('speechSynthesis' in window){
        const utter = new SpeechSynthesisUtterance(`${num}Âπ¥`);
        utter.lang = 'ja-JP';
        speechSynthesis.speak(utter);
      }
    }
  </script>
</body>
</html>
